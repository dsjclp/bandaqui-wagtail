{% extends "base.html" %}
{% load static wagtailcore_tags i18n %}

{% load static wagtailcore_tags wagtailimages_tags %}

{% load home_tags %}

{% block content %}

 <!-- Page Content -->
 <div class="container">

  <!-- Page Heading/Breadcrumbs -->
  <h1 class="mt-4 mb-3">{{ page.heading}}
    <small>{{ page.subheading}}</small>
  </h1>

    {% include 'breadcrumb.html' %}

    <!-- Content Row -->
    <div class="row">
      <!-- Map Column -->
      <div id='calendar' class="col-lg-8 mb-4"></div>
      <!-- Contact Details Column -->
      <div class="col-lg-4 mb-4">
        <h3>Prochaine prestation</h3>
        <hr>

        <h4>{{ nextevent.title }}</h4>

        <h5>DATE</h5>
        <ul class="list-unstyled">
          <h6><li><i class="far fa-clock"></i> Début : {{ nextevent.start_dt  }}</li></h6>
          <h6><li><i class="far fa-clock"></i> Fin : {{ nextevent.end_dt }}</li></h6>
        </ul>

        <h5>LIEU</h5>
        <h5>{{ nextevent.location }}</h5>
        <div id="macarte" style="height: 250px"></div>

        <hr>

        <button class="create-participation btn btn-primary" type="button" name="button">Inscrivez vous</button>
      
        <div class="modal fade" id="create-modal" tabindex="-1" role="dialog" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content"></div>
          </div>
        </div>

      </div>
    </div>
    <!-- /.row -->

  </div>
  <!-- /.container -->
{% endblock content %}

{% block extra_js %}

<script>
    $(document).ready(function () {
        $('#calendar').fullCalendar({
            lang: 'fr',
            header: {center: 'month','upcoming'},
            timeFormat: 'H(:mm)',
            nowIndicator: true,
            timezone: 'Europe/Paris', //Change as necessary
            eventColor: "#f8f9fa", //Change as necessary
            eventTextColor: "#9c27b0", //Change as necessary
            views: {
                upcoming: {
                    type: 'list',
                    duration: {months: 18},
                    buttonText: 'Liste à venir', //translate as necessary
                    validRange: function (nowDate) {
                        return {
                            start: nowDate,
                            end: nowDate.clone().add(18, 'months')
                        };
                    }
                }
            },
            // put your options and callbacks here
            events: '{{ page.get_url }}events/',

        eventClick: function(event) {
        //if you want to open url in the same tab
        location.href = 'events/'+page.slug;
        //if you want to open url in another window / tab, use the commented code below
        //window.open(event.url);
        //window.open('animation/event/'+event.id);
        return false;
            }
        });

        // Create participation button
        $(".create-participation").modalForm({formURL: "{% url 'home:create_participation' nextevent.slug|urlencode %}", modalID: "#create-modal"});

        // Create map
        var carte = L.map('macarte').setView([{{ nextevent.omap }}], 12);
        var marker = L.marker([{{ nextevent.omap }}]).addTo(carte);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://osm.org/copyright">OpenStreetMap</a>'
          }).addTo(carte);

    });
</script>
{% endblock %}
